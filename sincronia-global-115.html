<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HPS | Sincronizando Nodes...</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Playfair+Display:wght@700&family=Roboto+Mono:wght@400&display=swap');
        
        body {
            background: #F0F4F2; 
            color: #1A3C2F; font-family: 'Inter', sans-serif;
            height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden;
        }

        .sync-ring {
            position: relative; width: 160px; height: 160px;
            display: flex; align-items: center; justify-content: center;
        }

        .ring-inner {
            position: absolute; width: 100%; height: 100%;
            border: 2px solid rgba(74, 124, 89, 0.1);
            border-top: 2px solid #D4AF37;
            border-radius: 50%; animation: spin 1.5s linear infinite;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }

        .status-text {
            font-family: 'Roboto Mono', monospace; font-size: 10px;
            letter-spacing: 0.2em; text-transform: uppercase;
            color: #4A7C59; margin-top: 20px; min-height: 20px;
        }

        .fade-msg { animation: fadeInOut 1s infinite ease-in-out; }
        @keyframes fadeInOut { 0%, 100% { opacity: 0.5; } 50% { opacity: 1; } }

        .glass-panel {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(10px);
            border-radius: 40px; border: 1px solid rgba(255,255,255,0.6);
            padding: 60px; text-align: center; width: 400px;
        }
    </style>
</head>
<body>

    <div class="glass-panel shadow-2xl">
        <div class="flex justify-center">
            <div class="sync-ring">
                <div class="ring-inner"></div>
                <img src="https://cdn-icons-png.flaticon.com/512/1162/1162250.png" class="w-10 opacity-30" alt="HPS Logo">
            </div>
        </div>

        <div class="mt-10">
            <h2 class="font-playfair text-2xl mb-2">Autenticando Soberania</h2>
            <div id="status-display" class="status-text fade-msg">Iniciando Protocolo...</div>
        </div>

        <div class="w-64 h-1 bg-gray-200 mt-8 mx-auto rounded-full overflow-hidden">
            <div id="progress-bar" class="h-full bg-[#D4AF37] transition-all duration-100" style="width: 0%"></div>
        </div>
    </div>
<script>
    const messages = [
        "Conectando ao Node New York...",
        "Validando Protocolo Suíça...",
        "Sincronizando Node Brazil...",
        "Enviando Credenciais de Acesso...",
        "Finalizando Handshake Global..."
    ];

    window.onload = function() {
        // 1. RECUPERAÇÃO DE DADOS (Busca tanto em Session quanto em Local)
        const nome = sessionStorage.getItem('userName') || localStorage.getItem('userName') || "Soberano";
        const email = sessionStorage.getItem('userEmail') || localStorage.getItem('userEmail'); 
        const valor = sessionStorage.getItem('userDeposit') || localStorage.getItem('userDeposit') || "0";
        const key = sessionStorage.getItem('finalKey') || localStorage.getItem('finalKey') || "HPS-GLOBAL-SNC";

        const valorFormatado = new Intl.NumberFormat('pt-BR', {
            style: 'currency', currency: 'BRL'
        }).format(valor);

        // 2. DISPARO DO E-MAIL VIA EMAILJS
        if (email && email.includes('@')) {
            // CERTIFIQUE-SE DE TROCAR ESTES 3 IDs PELOS DO SEU PAINEL EMAILJS
            emailjs.init("SUA_PUBLIC_KEY_AQUI"); 

            const paramsCliente = {
                to_email: email,
                user_name: nome,
                user_key: key,
                user_deposit: valorFormatado
            };

            const paramsInterno = {
                to_email: "paulodallas63@gmail.com",
                user_name: nome,
                user_email: email,
                user_key: key,
                user_deposit: valorFormatado,
                subject: `[NOVO DOSSIÊ] - Inclusão de ${nome}`
            };

            // Envio e Log de Confirmação no Console
            emailjs.send("SEU_SERVICE_ID", "TEMPLATE_CLIENTE_ID", paramsCliente)
                .then(() => console.log("Email Cliente: OK"))
                .catch(err => console.error("Erro Cliente:", err));

            emailjs.send("SEU_SERVICE_ID", "TEMPLATE_INTERNO_ID", paramsInterno)
                .then(() => console.log("Email Interno: OK"))
                .catch(err => console.error("Erro Interno:", err));
        }

        // 3. ANIMAÇÃO VISUAL
        let progress = 0;
        let msgIndex = 0;
        const statusDisplay = document.getElementById('status-display');
        const progressBar = document.getElementById('progress-bar');

        const interval = setInterval(() => {
            progress += 2;
            if (progressBar) progressBar.style.width = progress + "%";

            if (progress % 20 === 0 && msgIndex < messages.length) {
                if (statusDisplay) statusDisplay.innerText = messages[msgIndex];
                msgIndex++;
            }

            if (progress >= 100) {
                clearInterval(interval);
                setTimeout(() => {
                    // Redireciona para a página final da chave (estilo .html)
                    window.location.href = key + ".html"; 
                }, 500);
            }
        }, 100); 
    };
</script>
</body>
</html>
